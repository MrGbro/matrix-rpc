# Matrix RPC é›†æˆæµ‹è¯•è¯´æ˜

## ğŸ¯ æ¨¡å—æ¶æ„ (2026-01-14 æ›´æ–°)

å·²å®Œæˆ**åŠŸèƒ½æµ‹è¯•æ‹†åˆ†åˆ°ç‹¬ç«‹æ¨¡å—**çš„æ¶æ„å‡çº§ï¼š

```
matrix-rpc-examples/
â”œâ”€â”€ matrix-rpc-example-api        # å…±äº«APIå®šä¹‰
â”œâ”€â”€ matrix-rpc-example-provider   # æœåŠ¡æä¾›è€…
â”œâ”€â”€ matrix-rpc-example-consumer   # åŸºç¡€æ¶ˆè´¹è€… (æ— æ²»ç†æ¡†æ¶)
â”œâ”€â”€ matrix-rpc-example-sentinel   # Sentinelæ²»ç†ä¸“é¡¹æµ‹è¯• âœ¨ NEW
â””â”€â”€ matrix-rpc-example-resilience4j  # Resilience4jæ²»ç†ä¸“é¡¹æµ‹è¯• âœ¨ NEW
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- âœ… ä¾èµ–éš”ç¦»ï¼šæ¯ä¸ªæ²»ç†æ¨¡å—åªä¾èµ–å¯¹åº”æ¡†æ¶ï¼Œé¿å…SPIå†²çª
- âœ… æµ‹è¯•ä¾¿åˆ©ï¼šæ— éœ€JVMå‚æ•°ç¦ç”¨å…¶ä»–æ¡†æ¶ï¼Œç›´æ¥è¿è¡Œ
- âœ… é…ç½®ç‹¬ç«‹ï¼šæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶
- âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢æ²»ç†æ¡†æ¶åªéœ€æ–°å»ºæ¨¡å—

---

## æµ‹è¯•å‡†å¤‡

1. **ç¼–è¯‘å¹¶å®‰è£…é¡¹ç›®**
```powershell
cd e:\Code\OpenSource\matrix-rpc
mvn clean install -DskipTests
```

## æµ‹è¯•åœºæ™¯

### åœºæ™¯1: Sentinel é™æµæµ‹è¯• âœ¨

**æ­¥éª¤1: å¯åŠ¨ Provider**
```powershell
# ç»ˆç«¯1
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-provider
mvn exec:java -Dexec.mainClass=io.homeey.example.provider.ProviderMain
```

**æ­¥éª¤2: è¿è¡Œé™æµæµ‹è¯• (æ–°æ¨¡å—)**
```powershell
# ç»ˆç«¯2
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-sentinel
mvn exec:java -Dexec.mainClass=io.homeey.example.sentinel.SentinelRateLimitTest
```

**é¢„æœŸç»“æœ**:
- æ­£å¸¸è°ƒç”¨æˆåŠŸ (QPS < 10)
- å¿«é€Ÿè°ƒç”¨è§¦å‘é™æµ (QPS > 10)
- è¾“å‡º: `âœ… Sentinel Rate Limiter is working!`

---

### åœºæ™¯2: Sentinel ç†”æ–­æµ‹è¯• âœ¨

**æ­¥éª¤1: å¯åŠ¨ Provider** (åŒä¸Š)

**æ­¥éª¤2: è¿è¡Œç†”æ–­æµ‹è¯• (æ–°æ¨¡å—)**
```powershell
# ç»ˆç«¯2
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-sentinel
mvn exec:java -Dexec.mainClass=io.homeey.example.sentinel.SentinelCircuitBreakerTest
```

**é¢„æœŸç»“æœ**:
- æ­£å¸¸è°ƒç”¨æˆåŠŸ
- é«˜é¢‘å¼‚å¸¸è§¦å‘ç†”æ–­ (50%å¼‚å¸¸ç‡)
- ç†”æ–­æœŸé—´è°ƒç”¨è¢«æ‹’ç»
- ç­‰å¾…10ç§’åæ¢å¤
- è¾“å‡º: `âœ… Sentinel Circuit Breaker is working!`

---

### åœºæ™¯3: Resilience4j é™æµæµ‹è¯• âœ¨

**âœ… æ— éœ€ç¦ç”¨ Sentinel**: ç‹¬ç«‹æ¨¡å—å¤©ç„¶éš”ç¦»ï¼Œä¸å†æœ‰å†²çªï¼

**æ­¥éª¤1: å¯åŠ¨ Provider**
```powershell
# ç»ˆç«¯1 (æ— éœ€ä»»ä½•JVMå‚æ•°)
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-provider
mvn exec:java -Dexec.mainClass=io.homeey.example.provider.ProviderMain
```

**æ­¥éª¤2: è¿è¡Œé™æµæµ‹è¯• (æ–°æ¨¡å—)**
```powershell
# ç»ˆç«¯2 (æ— éœ€ä»»ä½•JVMå‚æ•°)
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-resilience4j
mvn exec:java -Dexec.mainClass=io.homeey.example.resilience4j.Resilience4jRateLimitTest
```

**é¢„æœŸç»“æœ**:
- æ­£å¸¸è°ƒç”¨æˆåŠŸ (QPS < 10)
- å¿«é€Ÿè°ƒç”¨è§¦å‘é™æµ (QPS > 10)
- è¾“å‡º: `âœ… Resilience4j Rate Limiter is working!`

---

## é…ç½®æ–‡ä»¶

### Sentinel é…ç½®
ğŸ“ ä½ç½®: `matrix-rpc-example-sentinel/src/main/resources/sentinel-rules.properties`

```properties
# é™æµè§„åˆ™
sentinel.flow.io.homeey.example.api.EchoService.echo.qps=10
sentinel.flow.io.homeey.example.api.EchoService.getUser.qps=5

# ç†”æ–­è§„åˆ™
sentinel.degrade.io.homeey.example.api.EchoService.echo.errorRatio=0.5
```

### Resilience4j é…ç½®
ğŸ“ ä½ç½®: `matrix-rpc-example-resilience4j/src/main/resources/resilience4j-config.properties`

```properties
# é™æµå™¨é…ç½®
resilience4j.ratelimiter.limitRefreshPeriod=1
resilience4j.ratelimiter.limitForPeriod=10
resilience4j.ratelimiter.timeoutDuration=0

# ç†”æ–­å™¨é…ç½®
resilience4j.circuitbreaker.failureRateThreshold=50
resilience4j.circuitbreaker.slowCallDurationThreshold=1000
resilience4j.circuitbreaker.slidingWindowSize=10
```

---

## ğŸš€ å¿«é€Ÿæµ‹è¯• (æ¨è)

### ä¸€é”®è¿è¡Œå‘½ä»¤

**1ï¸âƒ£ Sentinel é™æµæµ‹è¯•**:
```powershell
# ç»ˆç«¯1: Provider
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-provider
mvn exec:java -Dexec.mainClass=io.homeey.example.provider.ProviderMain

# ç»ˆç«¯2: Sentinel é™æµæµ‹è¯•
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-sentinel
mvn exec:java -Dexec.mainClass=io.homeey.example.sentinel.SentinelRateLimitTest
```

**2ï¸âƒ£ Sentinel ç†”æ–­æµ‹è¯•**:
```powershell
# (Providerå·²å¯åŠ¨)
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-sentinel
mvn exec:java -Dexec.mainClass=io.homeey.example.sentinel.SentinelCircuitBreakerTest
```

**3ï¸âƒ£ Resilience4j é™æµæµ‹è¯•** (âœ¨ æ— éœ€ç¦ç”¨Sentinel):
```powershell
# (Providerå·²å¯åŠ¨)
cd e:\Code\OpenSource\matrix-rpc\matrix-rpc-examples\matrix-rpc-example-resilience4j
mvn exec:java -Dexec.mainClass=io.homeey.example.resilience4j.Resilience4jRateLimitTest
```

---

## éªŒè¯è¦ç‚¹

### âœ… Sentinel é™æµéªŒè¯
- [ ] æ­£å¸¸è°ƒç”¨å…¨éƒ¨æˆåŠŸ
- [ ] å¿«é€Ÿè°ƒç”¨éƒ¨åˆ†è¢«é™æµ
- [ ] æ—¥å¿—è¾“å‡º: `[WARN] Rate limit exceeded for resource: ...`
- [ ] æµ‹è¯•ç»“æœæ˜¾ç¤º: Rate Limited Count > 0

### âœ… Sentinel ç†”æ–­éªŒè¯
- [ ] æ­£å¸¸è°ƒç”¨æˆåŠŸ
- [ ] é«˜é¢‘å¼‚å¸¸åç†”æ–­å™¨æ‰“å¼€
- [ ] ç†”æ–­æœŸé—´è°ƒç”¨è¢«æ‹’ç»
- [ ] æ—¥å¿—è¾“å‡º: `[WARN] Circuit breaker triggered for resource: ...`
- [ ] ç­‰å¾…10ç§’åæ¢å¤

### âœ… Resilience4j é™æµéªŒè¯
- [ ] éœ€ç¦ç”¨ Sentinel
- [ ] æ­£å¸¸è°ƒç”¨å…¨éƒ¨æˆåŠŸ
- [ ] å¿«é€Ÿè°ƒç”¨éƒ¨åˆ†è¢«é™æµ
- [ ] æ—¥å¿—è¾“å‡º: `[WARN] Rate limit exceeded for resource: ...`

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: Provideræ— æ³•å¯åŠ¨

**å¯èƒ½åŸå› **: ç«¯å£è¢«å ç”¨

**è§£å†³**:
```powershell
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr "20880"

# æ€æ­»è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

### é—®é¢˜2: æ— é™æµæ•ˆæœ

**å¯èƒ½åŸå› **: é…ç½®æ–‡ä»¶æœªç”Ÿæ•ˆ

**æ£€æŸ¥**:
- ç¡®è®¤ `sentinel-rules.properties` åœ¨ `target/classes` ç›®å½•ä¸‹
- æŸ¥çœ‹å¯åŠ¨æ—¥å¿—,ç¡®è®¤è§„åˆ™åŠ è½½æˆåŠŸ
- æ£€æŸ¥èµ„æºåæ˜¯å¦æ­£ç¡®

### ~~é—®é¢˜3: Sentinelå’ŒResilience4jå†²çª~~ âœ… å·²è§£å†³

**âœ¨ æ¶æ„å‡çº§åä¸å†æœ‰å†²çªï¼**

- Sentinel æµ‹è¯•: åªä¾èµ– matrix-rpc-filter-sentinel
- Resilience4j æµ‹è¯•: åªä¾èµ– matrix-rpc-filter-resilience4j
- ä¾èµ–å®Œå…¨éš”ç¦»ï¼Œæ— éœ€ä»»ä½•JVMå‚æ•°

---

## æµ‹è¯•å®Œæˆæ ‡å¿—

âœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡**:
1. Sentinel é™æµæµ‹è¯•: Rate Limited Count > 0
2. Sentinel ç†”æ–­æµ‹è¯•: Circuit Breaker è§¦å‘
3. Resilience4j é™æµæµ‹è¯•: Rate Limited Count > 0

**è¾“å‡ºç¤ºä¾‹**:
```
========================================
Test Results:
  Success Count: 10
  Rate Limited Count: 10
  Total: 20
========================================

âœ… Sentinel Rate Limiter is working!
```

---

**æµ‹è¯•æ–‡æ¡£**: Matrix RPC Team  
**æœ€åæ›´æ–°**: 2026-01-14 (æ¶æ„é‡æ„: æ¨¡å—æ‹†åˆ†)
